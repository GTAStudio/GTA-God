# =========================================
# GTAGod 配置文件模板 v4.1
# =========================================
# 
# 重大更新 (v4.0):
#   - sing-box 升级到 1.13+，原生支持 naive inbound
#   - 移除 Caddy forwardproxy 插件依赖
#   - 统一由 sing-box 处理所有代理协议 (naive/anytls/anyreality)
#   - Caddy 仅负责 L4 分流和 TLS 证书申请
#
# 使用方法:
#   1. 复制此文件为 gtagod.conf
#   2. 填写你的配置
#   3. 运行 ./run.sh
#
# 注意: gtagod.conf 包含敏感信息，已加入 .gitignore
#
# =========================================

# =========================================
# 部署模式 (可选，默认 naive)
# =========================================
# naive      - 仅 NaiveProxy (sing-box native naive inbound)
# anytls     - NaiveProxy + AnyTLS
# anyreality - NaiveProxy + AnyReality (无需证书)
# l4         - 全部启用，443 端口共享 (推荐)
#
# 注意: 所有模式都使用 sing-box 1.13+ 处理代理协议
#       通过 Caddy Layer4 进行 SNI 分流
# =========================================
DEPLOY_MODE="l4"

# =========================================
# 基础配置 (必需)
# =========================================
# 你的域名，需要托管在 Cloudflare
DOMAIN="example.com"

# Cloudflare API Token
# 获取方式: Cloudflare Dashboard → My Profile → API Tokens
# 权限要求: Zone.DNS 编辑权限
CLOUDFLARE_API_TOKEN="your_cloudflare_api_token_here"

# NaiveProxy 认证信息
NAIVE_USER="your_username"
NAIVE_PASSWD="your_password_here"

# =========================================
# NaiveProxy 端口配置 (L4 分流模式)
# =========================================
# L4 模式时 NaiveProxy 的内部监听端口
# 外部统一通过 443 端口访问，由 Caddy L4 分流
NAIVE_PORT="8443"

# =========================================
# AnyTLS 配置 (模式 anytls/l4 时使用)
# =========================================
# AnyTLS 内部监听端口 (L4 模式时使用，非 L4 模式时对外)
ANYTLS_PORT="8445"

# AnyTLS 用户名和密码 (默认与 NaiveProxy 相同)
# 如需单独设置，取消注释并修改
# ANYTLS_USER="your_anytls_user"
# ANYTLS_PASSWORD="your_anytls_password"

# AnyTLS SNI 域名 (建议使用你自己域名的子域名，会用泛域名证书)
# 注意: AnyTLS 使用真实证书验证，SNI 必须与证书匹配
ANYTLS_SNI="api.example.com"

# =========================================
# AnyReality 配置 (模式 anyreality/l4 时使用)
# =========================================
# AnyReality 内部监听端口 (L4 模式时使用，非 L4 模式时对外)
ANYREALITY_PORT="8444"

# AnyReality 用户名和密码 (默认与 NaiveProxy 相同)
# 如需单独设置，取消注释并修改
# ANYREALITY_USER="your_anyreality_user"
# ANYREALITY_PASSWORD="your_anyreality_password"

# AnyReality SNI 域名 (可以是任意域名，Reality 不需要真实证书)
# 注意: 此 SNI 必须与 ANYREALITY_TARGET 保持一致！
# L4 模式下，此 SNI 同时用于 443 端口分流和 Reality 伪装
ANYREALITY_SNI="www.amazon.com"

# Reality 伪装目标服务器 (必须与 ANYREALITY_SNI 一致)
ANYREALITY_TARGET="www.amazon.com"

# =========================================
# Reality 密钥对
# =========================================
# 生成方式: docker run --rm ghcr.io/sagernet/sing-box generate reality-keypair
# 
# 建议: 固定密钥便于多服务器部署，所有服务器使用相同密钥
# 客户端只需保存一份公钥即可连接所有服务器
#
# 私钥 (服务器端使用，请勿泄露)
ANYREALITY_PRIVATE_KEY="your_private_key_here"

# 公钥 (客户端使用，可以分享)
ANYREALITY_PUBLIC_KEY="your_public_key_here"

# Short ID (8-16 位十六进制，客户端需要)
ANYREALITY_SHORT_ID="a1b2c3d4e5f67890"

# =========================================
# 高级配置 (可选)
# =========================================
# 强制使用指定的 ACME CA
# 可选值: letsencrypt, zerossl
# 默认随机选择以分散限制
# FORCE_ACME_CA="letsencrypt"

# =========================================
# 网络配置 (可选)
# =========================================
# 禁用 IPv6 (解决日本 Sakura VPS 等服务器的连接问题)
# 如果服务器有 IPv6 但无法正常使用，导致连接超时，请启用此选项
# 可选值: true, false
# 默认: false
DISABLE_IPV6="false"

# 是否启用 MPTCP (tcp_multi_path)
# 仅在内核支持 MPTCP 时开启，否则可能导致连接不稳定
# 可选值: true, false
# 默认: false
ENABLE_MPTCP="false"

# =========================================
# 证书等待与自动重试 (可选)
# =========================================
# 首次等待证书的最长时间（秒）
CERT_WAIT_MAX="180"
# 证书未就绪时的重试间隔（秒）
CERT_RETRY_INTERVAL="30"
# 证书重试次数上限（0 表示无限重试）
CERT_RETRY_MAX="0"
